<html>
  <head>
    <meta http-equiv="pragma" content="no-cache" />

    <script src="ConnectWiseHostedAPI.1.0.js"></script>
    <script src="util.js"></script>

    <script language="javascript">
      var connectWiseClientApi;
      var dirty = false;

      document.addEventListener("DOMContentLoaded", function (event) {
        onReady();
      });

      function onReady() {
        connectWiseClientApi = new ConnectWiseHostedAPI(
          "https://na.myconnectwise.net",
          {
            eventHandlers: [
              { event: "onLoad", callback: onLoadCallback },
              { event: "beforeSave", callback: beforeSaveCallback },
            ],
          },
          true
        );

        var required = document.getElementById("required");
        var number = document.getElementById("number");

        required.oninput = setDirty;
        number.oninput = setDirty;

        document.getElementById("btnMemberAuthentication").onclick =
          function () {
            connectWiseClientApi.post(
              { request: "getMemberAuthentication" },
              function (data) {
                document.getElementById("lblMemberAuthentication").innerText =
                  data.site +
                  " " +
                  data.companyid +
                  " " +
                  data.memberid +
                  " " +
                  data.memberHash +
                  " " +
                  data.memberEmail;
              }
            );
          };

        document.getElementById("btnRefreshScreen").onclick = function () {
          connectWiseClientApi.post({ request: "refreshScreen" });
        };

        document.getElementById("btnOpen").onclick = function () {
          openScreen();
        };
      }

      function openScreen() {
        var newTab =
          document.getElementById("lstTab").options[
            document.getElementById("lstTab").selectedIndex
          ].innerHTML === "new";
        var screenID =
          document.getElementById("lstScreen").options[
            document.getElementById("lstScreen").selectedIndex
          ].innerHTML;
        var id = document.getElementById("txtOpenID").value;

        connectWiseClientApi.post({
          request: "openScreen",
          args: { newTab: newTab, screen: screenID, id: id },
        });
      }

      function onLoadCallback(data) {
        showMsg(
          data.screenObject.screen +
            " loaded! Hosted as: " +
            data.screenObject.hostedAs
        );
        setField("recid", data.screenObject.id);
      }

      function setField(fieldID, value) {
        var field = document.getElementById(fieldID);
        field.value = value;
      }

      function beforeSaveCallback(data) {
        var required = document.getElementById("required");
        var number = document.getElementById("number");

        var errors = [];

        if (required.value == null || required.value == "") {
          required.className = "error";
          errors.push("Example required field is empty!");
        } else {
          required.className = "";
        }

        if (number.value != null && number.value != "" && isNaN(number.value)) {
          number.className = "error";
          errors.push("Example number field must be a number!");
        } else {
          number.className = "";
        }

        if (errors.length > 0) {
          data.onFailure(errors);
        } else {
          dirty = false;
          data.onSuccess();
        }
      }

      function setDirty() {
        if (dirty) {
          return;
        }

        dirty = true;
        connectWiseClientApi.post({
          request: "setDirty",
          args: { dirty: dirty },
        });
      }

      function showMsg(msg) {
        var lbl = document.getElementById("msg");
        lbl.innerText = msg;
      }
      
    </script>

    <script>
      loadJSON(
        "task-inventory.json",
        function (data) {
          myData = data;
        },
        function (xhr) {
          console.error(xhr);
        }
      );
      
    </script>

    <style>
      .drop-down {
        display: inline-block;
        padding: 1px;
      }

      .textbox {
        background-color: #bfbcb4;
        width: auto;
      }

      #product-list {
        width: 100px;
      }

      .error {
        border: 1px solid #ff0000;
        background-color: #ffeeee;
      }
      div {
        padding: 1px;
      }

      .drop-down {
        display: inline-block;
      }
    </style>
  </head>
  <body onload="populateProd()">
    <div id="dd" >
      <!-- <div class="drop-down" id="product-list"><select name="product-list" id="id-product" onchange="populateTaskList(this)">
            <option value="">-- Select Product--</option>
            </select>
          </div>
          
          <div class="drop-down" id="task-list" ><select name="task-list" id="id-task" onchange="showDesc(this)">
            <option value="">-- Select Task--</option>
            </select></div> -->
      <div class="drop-down">
        <p><b>product: </b></p>
      </div>
      <!-- product drop down div tag -->
      <div class="drop-down" id="id-product">
        <!-- products will get listed here -->
        <select id="product-list" onchange="populateTaskList(this)">
          <option value="">-- Select Product --</option>
        </select>
      </div>

      <div class="drop-down" id="id-taskList">
        <!--task drop down list for each product will come here  -->
        <select id="task-list" onchange="showDesc(this)">
          <option value="">-- Select Task --</option>
        </select>
      </div>
    </div>

    <div id="desc">
      <!-- Task Description goes here. -->
      <!-- Selected: Task Name -->
      <!-- Description: description of the task. -->

      <div class="textbox" id="id-link"></div>
      <div class="textbox" id="id-title"></div>
      <div class="textbox" id="id-task-desc"></div>
    </div>
  </body>
</html>
